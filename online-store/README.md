#  Система интернет-магазина на C++ и PostgreSQL

##  Описание проекта
Проект представляет собой полноценную систему интернет-магазина с поддержкой трех ролей пользователей: администратор, менеджер и покупатель. Система реализована с использованием принципов объектно-ориентированного программирования, умных указателей и интеграции с базой данных PostgreSQL.

##  Цель работы
- Реализовать систему интернет-магазина с ролевой моделью доступа
- Применить принципы ООП: наследование, полиморфизм, композиция
- Использовать умные указатели для управления памятью
- Интегрировать C++ приложение с PostgreSQL
- Реализовать транзакции, хранимые процедуры и триггеры

##  Используемые технологии
- **Язык программирования**: C++17
- **База данных**: PostgreSQL 12+
- **Библиотека для работы с БД**: libpqxx
- **Система сборки**: CMake 3.10+

##  Архитектура проекта

### Классовая структура
User (абстрактный)
├── Admin
├── Manager
└── Customer

Order
├── OrderItem (композиция)
└── Payment (композиция)

Product
DatabaseConnection<T> (шаблонный класс)
PaymentStrategy (абстрактный)
├── CardPayment
├── WalletPayment
└── SBPPayment

text

### Принципы ООП
1. **Наследование**: классы Admin, Manager, Customer наследуются от User
2. **Полиморфизм**: виртуальные функции для разных ролей
3. **Композиция**: Order содержит OrderItem и Payment
4. **Агрегация**: User содержит вектор shared_ptr<Order>

## Структура базы данных

### Таблицы
1. **users** - пользователи системы
2. **products** - каталог товаров
3. **orders** - заказы
4. **order_items** - позиции заказа
5. **order_status_history** - история статусов
6. **audit_log** - журнал аудита

### Хранимые процедуры
- `create_order_procedure` - создание заказа с транзакцией
- `update_order_status_procedure` - обновление статуса

### Функции
- `get_order_status` - получение статуса заказа
- `can_return_order` - проверка возможности возврата
- `get_audit_log_by_user` - логи аудита по пользователю

### Триггеры
- Автоматическое логирование изменений
- Обновление истории статусов
- Аудит операций с товарами

##  Умные указатели и STL

### Использование умных указателей
- `std::unique_ptr<Payment>` для композиции
- `std::shared_ptr<Order>` для агрегации
- Автоматическое управление памятью

### STL алгоритмы и лямбды
```cpp
// Фильтрация заказов по статусу
auto filtered = filterOrders(orders, "completed");

// Подсчет суммы заказов
double total = accumulate(orders.begin(), orders.end(), 0.0, 
    [](double sum, auto& order) { return sum + order->getTotal(); });

// Проверка прав доступа
auto hasPermission = [](User* user, string permission) {
    return user->hasPermission(permission);
};
Логика ролей и прав доступа
Администратор
Полный доступ ко всем функциям

Управление товарами и пользователями

Просмотр всех логов и отчетов

Менеджер
Утверждение заказов

Обновление информации о товарах

Доступ только к своим операциям

Покупатель
Создание и управление своими заказами

Оплата и возврат заказов

Доступ только к своим данным

Аудит и история изменений
Все критические операции логируются автоматически

История изменений статусов сохраняется

Доступ к аудиту ограничен по ролям

Отчет в формате CSV
Отчет "История изменений заказов и действий пользователей" формируется SQL-запросом и доступен только администратору.

Сборка и запуск
Требования к окружению
Компилятор C++17 (g++ 9+ или clang 10+)

PostgreSQL 12+

Библиотека libpqxx

CMake 3.10+
